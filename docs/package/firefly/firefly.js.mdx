import {Spec} from "@site/src/components/Spec";

# firefly.js

Firefly is configured by putting a `firefly.js` in the root of your project. This file imports the main `Firefly` class and must return a (configured) instance of it.

The base file can look like this:

```javascript
const {Firefly} = require("@21torr/firefly");

module.exports = (new Firefly())
	// configuration goes here
	;
```

:::tip
You can generate the base file by just running

```bash
pnpm firefly init
```
:::

The configuration of Firefly works by using the fluent methods on the configuration object, like this:

```javascript
const {Firefly} = require("@21torr/firefly");

module.exports = (new Firefly())
	.js({
		// ...
	})
	.scss({
		// ...
	})
	.disableFileNameHashing()
	// ...
	;
```


## Available configuration options
### `.js(entries)`

Adds JS / TypeScript entries.

<Spec
	language="js"
	params={[
		{
			name: "entries",
			type: "Record<string,string>",
			description: "The entry files. Key is the name of the entry, value is the relative path to the file.",
		},
	]}
>
	{`
		.js({
			app: "asset/js/app.ts",
			backend: "asset/js/backend.js",
		})
	`}
</Spec>


### `.scss(entries)`

Adds SCSS entries.

<Spec
	language="js"
	params={[
		{
			name: "entries",
			type: "Record<string,string>",
			description: "The entry files. Key is the name of the entry, value is the relative path to the file.",
		},
	]}
>
	{`
		.scss({
			app: "asset/scss/app.scss",
			backend: "asset/scss/backend.scss",
		})
	`}
</Spec>


### `.outputTo(path)`

Sets the output path, where the compiled files will be stored.
This is only the base path, the `js/` and `scss/` subdirectories will be created automatically.

If you don't configure anything, files will be built to `build/` by default.

<Spec
	language="js"
	params={[
		{
			name: "path",
			type: "string",
			description: "The path where to store the built files.",
		},
	]}
>
	{`
		.outputTo("some/path")
	`}
</Spec>


### `.withExternals(externals)`

Defines external packages on what they should compile to.

This is basically the following transformation:

```js
const jQuery = require("jquery");
// ↑ this will compile to ↓
const jQuery = window.jQuery;
```

<Spec
	language="js"
	params={[
		{
			name: "externals",
			type: "Record<string, string>",
			description: "A map from the import names to the global variable.",
		},
	]}
>
	{`
		.withExternals({
			ckeditor: "window.ClassicEditor",
			jquery: "window.jQuery",
		})
	`}
</Spec>


### `.compilePackages(...packages)`

Defines all package names, that should be compiled from `node_modules`. Will be prefix-matched, so it can be a concrete package name or a organization name.

<Spec
	language="js"
	params={[
		{
			name: "...packages",
			type: "string",
			description: "The names of the packages to compile.",
		},
	]}
>
	{`
		.compilePackages("package-1", "@vendor/package-2")
	`}
</Spec>

:::tip
Packages from the `@21torr` organization will be compiled by default.
:::


### `.disableFileNameHashing()`

Disables the hashing of the entry file names.
